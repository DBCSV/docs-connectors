= About Websocket Client Components
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: connectors, ws, wss, websocket

== Connector Client Components

=== Open Outbound Operation

This operation allows an OUTBOUND socket to establish a connection to a websocket endpoint.

In order to establish a connection a configuration reference must be provided. In addition, parameters like path and uri can be provided. For further reference check connector's technical reference.

The following example opens a connection reusing most of the settings defined in the configuration reference, but others like the uri are overridden.

[source,xml,linenums]
----
<flow ​name​=​"connect"​>
    ​<websocket:open-outbound ​path​=​"/relative/path" uri​=​"ws://mulestocks.com/quotes"​ ​config-ref​=​"ws"​ />
</flow>
----

==== Headers and Query Parameters

Default headers and query parameters can be set at the configuration level if they will be used for every request.

However, you can add custom headers or query parameters to your connect operation. These will be sent along with the default headers and parameters in the initial HTTP request to establish the WS connection. They can be set using DataWeave expressions as shown in the example below.

[source,xml,linenums]
----
<flow ​name​=​"connect"​>
    <websocket:open-outbound-socket path="/chatEcho" defaultGroups="#[['AVENGERS']]" config-ref="ws"
                                        target="connectionAttributes" targetValue="#[attributes]">
        <websocket:headers><![CDATA[
                #[
                    {
                        chatAlias: 'Captain Marvel',
                        personalities: 'Vers',
                        personalities: 'Carol Danvers'
                    }
                ]
            ]]>
        </websocket:headers>
        <websocket:query-params><![CDATA[
                #[
                    {
                        theme: 'USA'
                    }
                ]
            ]]>
        </websocket:query-params>
    </websocket:open-outbound-socket>
</flow>
----

==== Socket Id

A key piece of this operation is the socket id. For the produced socket to be any useful, we need to be able to uniquely identify it among any other active sockets. To do that, this operation has an optional socketId parameter which allows you to specify the id that the socket should be given.
The provided id must follow certain rules:

* It must be unique. No other active socket can have the same id. However, you can reuse ids from sockets that have already been closed
* It cannot be null or blank

If the socketId is not supplied, an id will be automatically be generated. You can access it through the ​WebSocketAttributes​ object that is returned by this operation.

=== Send Operation

This operation sends a message through one specific socket identified through its id.

[source,xml,linenums]
----
<flow ​name​=​"sendMessage"​>
    <websocket:send ​socketId​=​"#[attributes.socketId]"​ ​config-ref​=​"ws"​> ​
        <websocket:content>​<![CDATA[#[output application/json
            ---
            {
                phrase: "Higher, Further, Faster",
                age: 30
            }
            ]]]>
        ​</websocket:content>
    <websocket:send>
</flow>
----

=== Broadcast Operation

The broadcast operation enables a socket to send a message to all other sockets:

    * Subscribed to a specific group.
    * Listening at a specific path.
    * Of a specific type (INBOUND/OUTBOUND).

The type and group parameters work in tandem, in an additive way. They are both optional and can be used separately, but when used together they act as two levels of filtering.

[source,xml,linenums]
----
<!-- send to all active sockets connected to the /quotes endpoint -->
<websocket:broadcast path=”/quotes” ​config-ref​=​"ws"​ />

<!-- send to all INBOUND sockets connected to the /quotes endpoint -->
<websocket:broadcast path=”/quotes” ​type​=​"INBOUND"​ ​config-ref​="​ ws"​ />

<!-- send to all INBOUND sockets connected to the /quotes endpoint -->
<websocket:broadcast path=”/quotes” ​type​=​"OUTBOUND"​ ​config-ref​=​"ws"​ />

<!-- send to all INBOUND sockets connected to the /quotes endpoint, in the MARVEL and DC groups -->
<websocket:broadcast path=”/quotes” ​type​=​"INBOUND"​ ​groups​="​ #[['MARVEL', 'DC']]"​ ​config-ref​=​"ws"​ />
----

=== See Also

* xref:http/websocket-about-websocket-connector.adoc[About Websocket Connector]
* xref:http/websocket-connector-configuration.adoc[About Websocket Connector Configuration]
