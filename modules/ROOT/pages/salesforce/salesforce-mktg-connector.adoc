= Salesforce Marketing Cloud Connector
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Support Category: https://www.mulesoft.com/legal/versioning-back-support-policy#anypoint-connectors[Select]

Salesforce Marketing Connector Version 3.0

Release Notes: xref:release-notes::connector/salesforce-marketing-connector-release-notes-mule-4.adoc[Salesforce Marketing Connetor Release Notes]

The Anypoint Connector for Salesforce Marketing Cloud (Salesforce Marketing Cloud Connector) lets you connect to the Marketing Cloud API, which is also called Salesforce Marketing Cloud. This connector exposes convenient operations for using the capabilities of Salesforce Marketing Cloud.

== Prerequisites

This document assumes that you are familiar with Salesforce Marketing Cloud, Mule, Anypoint Connectors, Anypoint Studio, Mule concepts, elements in a Mule flow, and global elements.

You need login credentials to test your connection to your target resource.

To use this connector with Maven, view the pom.xml dependency information in the Dependency Snippets section of Anypoint Exchange.

== What's New in this Connector

Each operation now returns a map instead of a POJO. The map is a representation of the old POJO, with each POJO field name as a key and each POJO field value as a value.

== To Use the Connector in Design Center

To use the connector in Design Center:

. In Design Center, click *Create*.
. Click *Create new application* to open Flow Designer.
. Specify a value for *Project name* and click *Create*.
. Click *Go straight to canvas* to exit from *Letâ€™s get started*.
. Click on the trigger card.
. Search for the connector.
. Select the connector name.
. Select the *On modified object* or *On new object* operation to use it as a source.
+
Alternatively, you can also use the HTTP Connector or Scheduler component as a source.
+
. Click *Click here to set it up*.
. To create a global element for the connector, enter values for these fields:
+
image::salesforce/salesforce-mktg-dc-choose-global-type.png[Design Center global element]
+
For information, see <<salesforce/salesforce-mktg-connector#required-parms-user-pwd,Required Parameters for Username and Password>> and <<salesforce/salesforce-mktg-connector#required-oauth-parms,Required Parameters for OAuth Username and Password>>.
+
. Select the plus sign to add a component.
. Select the connector as a component.
. Configure these fields:
+
* *Create* operation:
** *Object Type* - Type of API object to create
** *Api Objects* - An array of one or more API objects
+
image::salesforce/salesforce-mktg-dc-create.png[Create fields]
+
* *Delete* operation:
+
** *Object Type* - Type of API object to delete
** *Api Objects* - An array of one or more API objects
+
image::salesforce/salesforce-mktg-dc-delete.png[Delete fields]
+
* *Update* operation:
+
** *Object Type* - Type of API object to update
** *Api Objects* - An array of one or more API objects
+
image::salesforce/salesforce-mktg-dc-update.png[SMC-update]
+
* *Upsert* operation:
+
** *Object Type* - Type of API object to upsert
** *Api Objects* - An array of one or more API objects
+
image::salesforce/salesforce-mktg-dc-upsert.png[SMC-upsert]
+
* *Configure Create* operation:
+
** *Object Type* - Type of configuration
** *Configurations* - An array of one or more configurations to create
+
image::salesforce/salesforce-mktg-dc-configure-create.png[DC-configure-create]
+
* *Configure Update* operation:
+
** *ObjectType* - Type of configuration
** *Configurations* - An array of one or more configurations to update
+
image::salesforce/salesforce-mktg-dc-configure-update.png[DC-configure-update]
+
* *Configure Delete* operation:
+
** *Object Type* - Type of configuration
** *Configurations* - An array of one or more configurations to delete
+
image::salesforce/salesforce-mktg-dc-configure-delete.png[DC-configure-delete]
+
* *Perform Start* operation:
+
** *Object Type* - Type of object on which to perform
** *Definitions* - An array of one or more definitions for the perform operation
+
image::salesforce/salesforce-mktg-dc-perform-start.png[DC-perform-start]
+
* *Perform Stop* operation:
+
** *Object Type* - Type of object that supports the Stop action of the Perform operation
** *Definitions* - An array of one or more definitions for the Perform operation
+
image::salesforce/salesforce-mktg-dc-perform-stop.png[DC-perform-stop]
+
* *Perform Get Max Count* operation:
+
** *Object Type* - Type of object on which to use a perform operation
** *Definitions* - An array of one or more definitions for a perform operation
+
image::salesforce/salesforce-mktg-dc-perform-get-max-count.png[DC-perform-get-max-count]
+
* *Schedule Start* operation:
+
** *Object Type* - Type of object for which to create a schedule
** *Interactions* - An array of one or more interactions in the Schedule operation
+
image::salesforce/salesforce-mktg-dc-schedule-start.png[DC-schedule-start]
+
* *Retrieve* operation:
+
** *Query* - Query describing the objects to retrieve
+
image::salesforce/salesforce-mktg-dc-retrieve.png[DC-retrieve]

[[required-parms-user-pwd]]
=== Required Parameters for Username and Password

* *Username* - Username used to initialize the session
* *Password* - Password used to authenticate the user
+
image::salesforce/salesforce-mktg-dc-user-pass-config.png[user-pass-config]

[[required-parms-user-pwd]]
=== Required Parameters for the OAuth Username and Password

* *Client ID* - Client ID for your installed package
* *Client Secret* - Client secret for your installed package
* *OAuth Endpoint* - Endpoint for the Identity Provider (IDP) responsible for issuing the API key
* *Soap Endpoint* - Endpoint for the Service Provider (SP) hosting services to be used with the issued API key
+
image::salesforce/salesforce-mktg-dc-oauth-user-pass-config.png[user-pass-config]
+
NOTE: Ensure that your client ID and client secret are stored securely in your app. Never expose this information by using JavaScript on the client side or store it in a mobile application.

== To Use the Connector in Anypoint Studio

You can use this connector in Anypoint Studio by downloading it from Exchange and configuring it as needed.

=== Install Connector in Studio

. In Anypoint Studio, click the Exchange *(X)* icon in the Studio taskbar.
. In Exchange, click *Login* and supply your Anypoint Platform username and password.
. Search for the connector.
. Select the connector and click *Add to Project*.
. Follow the prompts to install this connector.

When Studio has an update, a message displays in the lower right corner, which you can click to install the update.

=== Configure in Studio

. Drag the connector to the Studio canvas.
. To create a global element for the connector, add values to these fields:
* Connection Username Password:
** *Username* - Username used to initialize the session
** *Password* - Password used to authenticate the user
+
image::salesforce/salesforce-mktg-as-user-pass-config.png[user-pass-config]
+
* Connection OAuth Username Password:
** *Client ID* - Client ID for your installed package
** *Client Secret* - Client secret for your installed package
** *OAuth Endpoint* - Endpoint for the Identity Provider (IDP) responsible for issuing an API key
** *Soap Endpoint* - Endpoint for the Service Provider (SP) hosting services to be used with the issued API key
+
image::salesforce/salesforce-mktg-as-oauth-user-pass-config.png[user-pass-config]

=== Use Case - Creating an Object

. Create a new Mule project by selecting *File > New > Mule Project*.
. Supply a name for your project and click *Finish*.
+
image::salesforce/salesforce-mktg-as-new-mule-project.png[New project dialog]
+
. When you code a Mule app manually, include this XML snippet in the pom.xml file to enable access to this connector. Mule translates the RELEASE dependency keyword to the current version.
+
[source,xml,linenums]
----
<dependency>
    <groupId>org.mule.connectors</groupId>
    <artifactId>mule-module-sfdc-marketing-cloud-connector</artifactId>
    <version>RELEASE</version>
    <classifier>mule-plugin</classifier>
</dependency>
----
+
. Create the flow.

Navigate through the project's structure, double-click `src/main/app/smc-usecase-create-object.xml`, and follow these steps:

. In the Mule Palette view, search for the *HTTP Listener* component.
. Drag the *Listener* component onto the canvas.
. Search for the *Transform Message* component and drag it to the right of the *Listener* component.
. Search for *Salesforce Marketing Cloud -> Create* and drag it to the right of the *Transform Message* component.
. Add a *Transform Message* component after the *Create* component.
.  Double-click on the *Listener* component.
+
image::salesforce/salesforce-mktg-as-http-listener-config.png[HTTP Listener component]
+
. Click image:salesforce/salesforce-mktg-as-plus-button.png[plus Button] next to *Connector configuration*.
. Specify the *Host* as localhost and *Port* as `8081`.
. Click *OK*.
. Specify the *Path* as `/create`.
. Double-click *Create*.
+
image::salesforce/salesforce-mktg-as-smc-create-config.png[SMC Create config]
+
. Click image:salesforce/salesforce-mktg-as-plus-button.png[plus Button] next to *Connector configuration*.
+
image::salesforce/salesforce-mktg-as-user-pass-config.png[SMC user-pass config]
+
. Specify the required fields with the credentials for your organization.
. Click *OK*.
. From the *Object type* drop down, select `List`.
. Double-click the *Transform Message* component to the left of the *Create* component and configure it as follows:
+
image::salesforce/salesforce-mktg-as-transform-before-config.png[Transform message before]
+
. Double-click the *Transform Message* component to the right of the *Create* component and configure it as follows:
+
image::salesforce/salesforce-mktg-as-transform-after-config.png[Transform message after]
+
. When you finish creating the Mule app, you can deploy it.
. Once deployed, use a REST client to make a POST request to `+x-www-form-urlencoded to localhost:8081/create+`. Include the parameter payload `listName`. For example: `+curl -d listName=MyName-Test localhost:8081/create+`).
+
You should receive a successful result.
+
. Go to your instance and check that the list was created.

You can use a similar flow for other entities, but you must:

* Change the Object Type value in the Salesforce Marketing Cloud to the name of the object to create.
* Remap fields on the Transform Message component as needed.

You can configure the Upload and Delete operations in the same way.

=== Use Case: XML

You can check your code against the complete application's XML representation, shown below.

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:sfdc-marketing-cloud="http://www.mulesoft.org/schema/mule/sfdc-marketing-cloud"
xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core
http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/sfdc-marketing-cloud
http://www.mulesoft.org/schema/mule/sfdc-marketing-cloud/current/mule-sfdc-marketing-cloud.xsd">
	<configuration-properties file="mule-app.properties" />
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<sfdc-marketing-cloud:sfdc-marketing-cloud-config name="Salesforce_Marketing_Cloud_Sfdc_marketing_cloud_config" doc:name="Salesforce Marketing Cloud Sfdc marketing cloud config">
		<sfdc-marketing-cloud:basic-connection username="${config.username}" password="${config.password}" authEndPoint="${config.endpoint}" />
	</sfdc-marketing-cloud:sfdc-marketing-cloud-config>
	<flow name="smc-usecase-create-objectFlow">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="/create"/>
		<ee:transform doc:name="Transform Message">
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/java
---
[{
	ListName: payload.listName
}]]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<sfdc-marketing-cloud:create doc:name="Create" config-ref="Salesforce_Marketing_Cloud_Sfdc_marketing_cloud_config" objectType="List"/>
		<ee:transform doc:name="Transform Message">
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</flow>
</mule>
----

== Known Issues and Limitations

The Salesforce Marketing Cloud connector has some Limitations when working with subclasses inside complex fields, trying to retrieve fields from a hierarchy, or attempting to return an Automation object.

=== Working with Subclasses inside Complex Fields

Some objects in Salesforce Marketing Cloud have complex fields, such as the Recurrence filed, that belong to a base class. DataSense can only bring up fields specific to the base class.

To use additional fields that belong to a subclass of a base class, manually add the desired fields to the Transform Message component. For Salesforce Marketing Cloud to know that you want to work with a subclass and recognize the fields you added, you must also add a field called concreteClassType of type `String` whose value is the name of the subclass.

See the <<salesforce/salesforce-mktg-connector#providing-subclass,Providing a Subclass as a Type to a Complex Field>> for an example.

=== Retrieving Fields From a Hierarchy

The Retrieve operation allows you to retrieve records in a SQL query-like fashion. When you use the Retrieve operation, Salesforce Marketing Cloud prevents the retrieval of fields that are part of a hierarchy. For example, the Subscriber object has a complex structure:

image::salesforce/salesforce-mktg-as-subscriber-structure.png[subscriber structure]

The API only allows you to query fields on the first level, such as EmailAddress or SubscriberKey, but not fields like Attributes.Name.

=== Server Results Containing an Automation Object

Server results that contain an Automation object cause an exception to be thrown. When performing an operation, such as Create or Delete, on an Automation object, the returned result contains the structure of the Automation object you acted upon. The server also returns an additional field in the Automation called `isPlatformObject` that is not recognized by the WSDL.

To bypass this issue, make all operations that directly use an Automation object asynchronous. If an operation is asynchronous, the immediate response of the operation is `Operation Queued`.

For more information, see the <<salesforce/salesforce-mktg-connector#asynchronous-operations,Asynchronous Operations>>.

== Common Use Cases

The following use cases are common for Salesforce Marketing Cloud connector:

* Configure Create operation - Calls the Configure command with Create as the action attribute when connected to the Marketing Cloud API SOAP web service.
* Configure Delete operation - Calls the Configure command with Delete as the action attribute when connected to the Marketing Cloud API SOAP web service.
* Configure Update operation - Calls the Configure command with Update as the action attribute when connected to the Marketing Cloud API SOAP web service.
* Create operation - Creates a new object on the Marketing Cloud API web server.
* Delete operation - Deletes an existing object on the Marketing Cloud API web server.
* Perform get max count operation - Calls the Perform command with GetMaxCount as the action attribute when connected to the Marketing Cloud API SOAP web service.
* Perform start operation - Sends a Perform command having Start as an action attribute when connected to the Marketing Cloud API SOAP web service.
* Perform stop operations - Sends a Perform command having Stop as an action attribute when connected to the Marketing Cloud API SOAP Web service.
* Retrieve operation - Retrieves objects from the Marketing Cloud API web server in a SQL query-like fashion.
* Schedule operation start - Calls the Schedule command with Start as the action attribute when connected to the Marketing Cloud API SOAP web service.
* Update operation - Updates an existing object on the Marketing Cloud API web server.
* Upsert operation - Creates an object if the object does not already exist, or deletes an existing object on the Marketing Cloud API web server. This operation uses the Create method of the Salesforce Marketing Cloud SOAP API.

=== Add a Proxy

To use a proxy server, the following system properties must be set at runtime:

[source,text,linenums]
----
Dhttp.proxyHost =<proxy host>
Dhttp.proxyPort=<proxy port>
----

If the proxy server requires authentication, these Java system properties must also be set at runtime:

[source,text,linenums]
----
Dhttp.proxyUser=<proxy user>
Dhttp.proxyPassword=<proxy password>
----

[[providing-subclass]]
=== Providing a Subclass as a Type to a Complex Field

Suppose your want to schedule an existing Automation that send emails to a subscriber list once per minute. To do this, add a Schedule Reference to the connector through a flow variable:

image::salesforce/salesforce-mktg-as-schedule-start-automation.png[Schedule Start Automation]

Use the Recurrence field in ScheduleDefinition to provide information such as how much time should pass between emails sent. The Recurrence field is a complex field that has no structure.

To specify a MinutelyRecurrence instead of a Recurrence:

* Manually add the fields belonging to the MinutelyRecurrence class.
* Add an additional field called concreteClassType of type String whose value is the name of the subclass.

The mapping for the ScheduleDefinition looks like this in the example:

image::salesforce/salesforce-mktg-as-schedule-definition-transform-config.png[Schedule Definition]

This map has a field called minuteInterval that belongs to a subclass of Recurrence called MinutelyRecurrence.

For the connector to use the MinutelyRecurrence object, you must also add the concreteClassType field with MinutelyRecurrence as the value.

[[asynchronous-operations]]
=== Asynchronous Operations

Most operations are synchronous by default, meaning that the connector waits for the result of the operation. For more details regarding the operations from Marketing Cloud API, access the Salesforce Marketing Cloud Methods documentation listed in the See Also section of this document.

To specify that you want an operation to behave asynchronously, use the Options parameter for the operation.

The following example creates a list of Automation objects to provide in the payload. Because the result of any operation that works directly with Automation objects throws an exception caused by the presence of an unknown field, the example uses the CreateOptions parameter to make the call asynchronous. In this example, the CreateOptions is provided in a variable called `vars`.

image::salesforce/salesforce-mktg-as-create-automation-config.png[Create Automation]

This mapping for CreateOptions in vars looks like this:

* The requestType field determines the type of call (SYNCHRONOUS or ASYNCHORONOUS).
* The conversationID field assigns a unique identifier to the asynchronous call.

You can group asynchronous calls together using the conversationID, callsInConversation, and sequenceCode fields. For example, suppose you want to make five asynchronous calls to the server, execute the calls together, and specify their execution order. To do this:

* Assign the same conversationID to each call.
* Set the callsInConversation field to `5`.
* Use the sequenceCode field to order the calls.

The following example has a single call, so it passes a value of 1 to callsInConversation and sequenceCode.

image::salesforce/salesforce-mktg-as-create-automation-options.png[CreateOptions]

The Options parameter has more functionality than shown in this example. For more information, see the Salesforce Marketing Cloud Objects documentation.

== See Also

* https://developer.salesforce.com/docs/atlas.en-us.mc-apis.meta/mc-apis/getting_started_developers_and_the_exacttarget_api.htm[Salesforce Get Started with the SOAP Web Services API]
* https://developer.salesforce.com/docs/atlas.en-us.mc-app-development.meta/mc-app-development/api-integration.htm[Salesforce API Integration]
* https://help.mulesoft.com[MuleSoft Help Center]
